<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Serif Pro,serif'; font-size:x-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">Secure your boot process: UEFI + Secureboot + EFISTUB + Luks2 + lvm + ArchLinux</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">This tutorial isn’t a basic setup how-to in a way you will learn how to install Arch Linux, neither is intended to replace the</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><a href="https://wiki.archlinux.org/index.php/Installation_guide"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">Installation Guide</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">, This is a guide for those who want a laptop with data-at-rest encryption and a verified boot process using SecureBoot.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">I’ll not be arrogant saying that this setup is “tampering-proof” since this also depends on your firmware manufacturer, but I believe that this is a notebook setup with good enough security.</span></p>
<p style=" margin-top:9px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="what-is-this-blogpost-about"></a><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">W</span><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">hat is this blogpost about</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Arch Linux setup overview.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Basic secureboot explanation.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Luks2+lvm setup for encrypted partitions at boot time.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">/home disk setup with crypttab.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">EFISTUB to make Linux “it’s own bootloader” avoiding the entire </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">/boot</span><span style=" font-size:16px;"> to be mounted on your ESP.</span></li></ul>
<p style=" margin-top:9px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="secureboot-drama"></a><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">S</span><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">ecureboot drama</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">UEFI is the new standard for boot and firmware management and it isn’t perfect, but is a natural answer to the old BIOS standard that has it’s limitations and is not aging well considering those limits and all workarounds involved to break them. You can find more information</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><a href="https://uefi.org/faq"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">here</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. BIOS standard first appeared in IBM computers in 1976 and should (hopefully) die soon.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">To keep words/concepts best alligned with what is correct, i’ll not call your basic computer program BIOS but firmware from now on during this reading.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">I bought a laptop and wanted to encrypt all my data and thought: “Hey, i can do a full disk encryption but what if someone tamper my</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><a href="https://en.wikipedia.org/wiki/Master_boot_record"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">MBR/Boot Sector</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">? So, using secureboot whas the best alternative (even with efi having a plain </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">FAT32</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> partition on it’s standard).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">There’s a lot of drama around secureboot, most of it related to Microsoft and the way they demand deploying their keys on OEM vendor equipments. That doesn’t mean that secureboot is bad.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Pretty simple “explain like i’m five” secureboot concept: A Root of Trust combination with keys and certificates. Using SecureBoot your firmware will check if the operating system you are trying to boot and your bootloader are trusted by you. On each boot-up UEFI firmware will inspect what you are trying to boot and if it’s not trusted a security violation will be triggered.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">There are four main EFI “variables” used to create a basic secureboot Root of Trust environment:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">PK: The Platform Key, the master one, the </span><a href="https://en.wikipedia.org/wiki/One_Ring"><span style=" font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">ring to rule them all</span></a><span style=" font-size:16px;">. The holder of a PK can install a new PK and update the KEK.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">KEK: Key Exchange Key is a secondary key used to sign EFI executables directly or a key used to signd the db and dbx databases.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">db: The signature databse is a list with all allowed signing certificates or criptografy hashes to allowed binaries. We will use THIS db key to sign our Linux Kernel.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">dbx: The dark side of the db. Inverse db. “not-good-db”. You name it. It’s the list containing all keys that are not allowed.</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">I would like to highlight the following points of this setup:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Your signing keys are stored inside an encrypted disk.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Kernel signing will only happend after you have booted and running an already signed kernel.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Most notebooks today don’t have an exposed CMOS to keep configurations but instead they have nvram modules that will store firmware and configurations.</span></li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">So, put a passord on your firmware to avoid secureboot being disabled.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Putting a password on your firmware will almost invalidate any chance of boot option change or secureboot disable.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">In my case there is no “reset bios password” option and losing it will require contacting Lenovo to replace the main board.</span></li></ul>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Even with secureboot disabled, and attacker will not be able to decrypt your root partition without knowing your password</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">If you are worried about keys being accessed after booting, you have other issues to solve and disk encryption + secureboot will not be the answer.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Modern processors have </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">aes-ni</span><span style=" font-size:16px;"> instuction that will help on disk decryption avoiding high cpu usage for this task.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Using a key to unlock luks </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">/home</span><span style=" font-size:16px;"> partition is a way to increase convenience without sacrificing security. That key is stored inside another encrypted partition so, there is no much to worry about.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">lvm inside a luks container gives you a lot of flexibility. This will also remove any visibility if someone steal you equipment since lvs will be inside one container.</span></li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Less error prone setup while manipulating </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">UUID</span><span style=" font-size:16px;">s is also an implicit feature.</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">With that in mind, lets install ArchLinux, first boot it and create the Root of Trust of your notebook.</span></p>
<p style=" margin-top:9px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="installing-arch-linux"></a><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">I</span><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">nstalling Arch Linux</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">There’s a plenty of “efi how-tos” for Arch Linux on the internet, and some of the instructions here will be just an overview of what you dear reader will have to execute</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 01</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Download Arch Linux </span><a href="https://www.archlinux.org/download/"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">here</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and write it to a pendrive using </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">dd bs=4M if=path/to/archlinux.iso of=/dev/sdx status=progress oflag=sync</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> where</span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sdx</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is your pendrive. If you are using Windows to create your bootable pendrive </span><a href="https://sourceforge.net/projects/win32diskimager/"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">Win32 Disk Imager</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> will help you.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 02</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Configure your firmware to boot using UEFI, but keep secure boot disabled. Allow boot from usb and change it to be your first boot device. These instructions are pretty much vendor dependent and can change depending on your equipment.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 03</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Boot Arch Linux live usb, and after getting a shell change your keybord layout with the following command: </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">loadkeys br-abnt2</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">After that, connect to your wifi using</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">wifi-menu -o your_device</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. There is an issue with the latest Arch Linux iso(06/2020) and </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">wifi-menu</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is not working as expected. If you are using ethernet just ignore this step. Enable ntp sync with </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">timedatectl set-ntp true</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 04</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Create </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">luks2</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> containers and </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">lvm2</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> volumes on the first disk. On my laptop i have 2 drives: </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sda</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is a ssd while </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sdb</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is a spinning disk. Use </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cgdisk /dev/sda</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and create a 256MB(i’m using 512MB but noticed that is way too much) partition for EFI (</span><a href="https://wiki.archlinux.org/index.php/EFI_system_partition"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">ESP</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">) code </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">ef00</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and the rest of your disk space create a partition with code </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">8309</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">(Linux Luks).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create your luks container and open it. Default block cipher and block encyption mode should be good enough so there is no need of changing it with</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">-c</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> parameter:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cryptsetup -y -v --use-random luksFormat /dev/sda2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cryptsetup luksOpen /dev/sda2 crypt</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create your lvm infraesturucture on top of it. I’ll create swap and root logical volumes</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">pvcreate /dev/mapper/crypt</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">vgcreate vg0 /dev/mapper/crypt</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">lvcreate --size 4G vg0 --name swap</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">lvcreate --size 30G vg0 --name root</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Format your ESP, root and swap partitions/volumes</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkfs.vfat -F32 /dev/sda1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkfs.ext4 /dev/mapper/vg0-root</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkswap /dev/mapper/vg0-swap</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 05</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> Now create a </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">luks2</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> container without lvm on it cause we will use the full disk just for </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/home</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and automatically map/mount it using </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">crypttab+fstab</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> here. Instead of typing a password 2 times during boot(one for root, another for home), we will just type the password for the root partition and host a key inside this encrypted partition to open the home luks container. Using a key to open a luks device has the same risks as typing a password and storing it into your ram. </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cgdisk /dev/sdb</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and create an all-disk partition using </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">8309</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> partition code.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cryptsetup -y -v --use-random luksFormat /dev/sdb1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cryptsetup luksOpen /dev/sda1 crypthome</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkfs.ext4 /dev/mapper/crypthome</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 06</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> Mount all and start to install:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mount /dev/mapper/vg0-root /mnt</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkdir /mnt/efi</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkdir /mnt/home</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mount /dev/sda1 /mnt/efi</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mount /dev/mapper/crypthome /mnt/home</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">pacstrap /mnt base base-devel vim efibootmgr linux linux-firmware lvm2 mkinitcpio networkmanager intel-ucode git efitools wget python</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Do not install</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">intel-ucode</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> if you are using an AMD processor.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 07</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Create your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">fstab</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and change root to your new system</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">arch-chroot /mnt</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 08</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Change your fstab </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/home</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> mount point to use the device mapper name. If you try to mount it using </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">UUID</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> it will fail cause it needs to be decrypted first.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;"># /home</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/dev/mapper/crypthome	/home     	ext4      	rw,relatime	0 2</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create a key to automatically open the home luks container. Change the “secretfolder” path example as you please.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkdir /root/secretfolder</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">chmod 700 /root/secretfolder</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">dd bs=512 count=4 if=/dev/urandom of=/root/secretfolder/crypto_keyfile.bin</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Find the UUID of your home luks container(</span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sdb1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> not </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">crypthome</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">) and add it to your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/etc/crypttab</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. Crypttab columns are: mapping name(crypthome), luks partition UUID, key path and luks. You can check disks UUID by issuing </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">blkid /dev/yyy</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> where </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">yyy</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> could be a partition or a disk. In this case, use </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sdb1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">crypthome UUID=29d3555d-cccc-yyyy-xxxx-xxxxxxxxxxxx /root/secretfolder/crypto_keyfile.bin luks</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 09</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Configure the rest of the system. Remember, this is just an overview of the Arch Linux installation and the focus here is on the secureboot aspect of this setup. In this step we will configure locale, localtime, keymap, hostname and user. I’m configuring a setup for a Brazilian Portuguese user so, change this info to reflect your language.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">ln -s /usr/share/zoneinfo/America/Sao_Paulo /etc/localtime</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">hwclock --systohc</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">echo LANG=pt_BR.UTF-8 &gt; /etc/locale.conf</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">echo KEYMAP=br-abnt2 &gt; /etc/vconsole.conf</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">echo hostname_i_want &gt; /etc/hostname</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Uncomment the</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">pt_BR.UTF-8 UTF-8</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> line inside </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/etc/locale.gen</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and generate this localization with:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">locale-gen</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create a password for root, and the basic info for your user(change</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">myuser</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> to your login):</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">passwd</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">useradd -m -g users -G wheel myuser</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">passwd myuser</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 10</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Edit your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkinitcpio.conf</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and include the </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">HOOKS</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">keyboard</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">, </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">keymap</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">, </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">lvm2</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">resume</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. Include </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">ext4</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> on </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">MODULES</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and change </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">COMPRESSION</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> to </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cat</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. You can check my config file </span><a href="https://gitlab.com/nwildner/dotfiles/-/blob/master/etc/mkinitcpio.conf"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">here</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. Recreate your initd:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkinitcpio -p linux</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">You may have noticed the</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">i915</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> module on my </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkinitcpio.conf</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. That’s how you avoid video flickering during the boot process if you are a user of an Intel Integrated graphics card.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 11</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Lets check if your motherboard is able to handle EFI entries using the following command:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">bootctl status| grep -i &quot;sets&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">       ✓ Boot loader sets ESP partition information</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">If this option is marked with</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">✓</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> or a green square you will be able to set boot information on your motherboard directly. Otherwise, you’ll have to rely on a bootloader like </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. You could obviously use the default EFI fallback option (</span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">EFI/BOOT/BOOX64.EFI</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">) but the sofware we will use to automatically create the EFISTUB and sign it will not put your STUB on that location.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">You can’t use grub here cause it does not support luks2 volumes</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><a href="https://savannah.gnu.org/bugs/?55093"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">yet</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> (maybe 2.06 will do).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 12</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">(optional): Install </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> as a first boot measurement for efi boot:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">bootctl --esp-path=/efi install</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">We will use this bootloader for the very first time to keep things simpler and to have the flexibility to boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">KeyFile</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> when we were ready to deploy our efi Root of Trust.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">After signing our first kernel and after we are sure that we will not be locked outside we can get rid of</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> just by removing the </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/EFI/systemd/systemd-bootx64.efi</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/EFI/BOOT/BOOX64.EFI</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and changing the boot order with </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">bootctl</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/loader/loader.conf</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">default signed.conf</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">editor no</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/loader/entries/signed.conf</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">title Arch</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">efi /BOOT/Arch/linux-signed.efi</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/loader/entries/keytool.conf</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">title KeyTool</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">efi /BOOT/KeyTool.efi</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Copy KeyTool:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cp /usr/share/efitools/efi/KeyTool.efi /efi/BOOT/KeyTool.efi</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 13</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">: Manually create your EFISTUB containing OS release data, command line options, kernel and initrd:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Create</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/boot/cmdline.txt</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cryptdevice=UUID=08be6138-ffff-vvvv-dddd-tttttttttttt:lvm:allow-discards resume=/dev/mapper/vg0-swap root=/dev/mapper/vg0-root rw quiet i915.fastboot=1</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cryptdevice</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is your luks2 partition. I’m using UUID here but you could use </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">=/dev/sda2</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> device path if you like but remember, UUIDs are better to make your system less error prone to disk changes. </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">resume</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> parameter is not needed if you will not use hibernation. </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">root</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> device needs to point to your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">lvm2</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> mapping name, </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">rw</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">quiet</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> are pretty much standard boot options and </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">i915.fastboot=1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is used for that flickering behavior I’ve mentioned above.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Cd to your /boot dir and create the efi:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cd /boot</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">objcopy \</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">    --add-section .osrel=/etc/os-release --change-section-vma .osrel=0x20000 \</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">    --add-section .cmdline=&quot;cmdline.txt&quot; --change-section-vma .cmdline=0x30000 \</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">    --add-section .linux=&quot;vmlinuz-linux&quot; --change-section-vma .linux=0x40000 \</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">    --add-section .initrd=&quot;initramfs-linux.img&quot; --change-section-vma .initrd=0x3000000 \</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">    /usr/lib/systemd/boot/efi/linuxx64.efi.stub /efi/BOOT/Arch/linux-signed.efi</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Step 13.1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">(optional): If you didn’t ran into step 12, you could just copy </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/BOOT/Arch/linux-signed.efi</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> to </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/EFI/BOOT/BOOX64.EFI</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> to have a first boot, and you could create manually a boot entry to your KeyTool efi. </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is just a little helper during your setup.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; font-weight:696; color:#4d4d4c;">Reboot.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">If something goes wrong here, you can boot your Live usb Arch Linux and open your luks2 partitions with</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cryptSetup luksOpen</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and remap all your volumegroups with </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">lvscan -a</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. Nothing to worry. You should be prompted luks root device password after your system start.</span></p>
<p style=" margin-top:9px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="creating-your-root-of-trust"></a><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">C</span><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">reating your Root of Trust</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">There is no need to reinvent the wheel so, we will use a pretty good script from mr. Roderick W. Smith aka rodsbooks.com. Check out his page for tons of informations related to EFI and other Linux related stuff. Access</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><a href="http://www.rodsbooks.com/efi-bootloaders/controlling-sb.html#creatingkeys"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">http://www.rodsbooks.com/efi-bootloaders/controlling-sb.html#creatingkeys</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> download the script directly:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">su - root</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cd /root</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">mkdir keys</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cd keys</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">wget https://www.rodsbooks.com/efi-bootloaders/mkkeys.sh</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Let’s explain the contents on this script:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">openssl</span><span style=" font-size:16px;"> commands will basically create key and certificate pairs for PK, KEK and DB on X509 format</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">python</span><span style=" font-size:16px;"> line will randomly create a </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">GUID</span><span style=" font-size:16px;"> for our secureboot assets (think it like a name to our keys)</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">cert-to-efi-sig-list</span><span style=" font-size:16px;"> is the software that will convert X509 certificates(openssl ones) to a format that EFI can understand</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">touch</span><span style=" font-size:16px;"> will crate an empty noPK file since we do not have a list of revoked keys</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">sign-efi-sig-list</span><span style=" font-size:16px;"> commands will sign PK with itself, sign noPK using PK, sign KEK using PK and finally sign DB using KEK creating all your root trust.</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">After taking a look at the script, just run it :)</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">chmod +x mkkeys.sh</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">./mkkeys.sh</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Install</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sbupdate</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> software from AUR. Use an AUR helper (best choice is </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">yay</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> from </span><a href="https://blackarch.org/downloads.html"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">Blackarch repository</span></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">) or build it by manually.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Edit</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/etc/sbupdate.conf</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> to change your signed EFISTUB output location and to also sign your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> efi for now. Add your boot parameters on the </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">CMDLINE_DEFAULT</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> line.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">#KEY_DIR=&quot;/etc/efi-keys&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">ESP_DIR=&quot;/efi&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">OUT_DIR=&quot;BOOT/Arch&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">#SPLASH=&quot;/usr/share/systemd/bootctl/splash-arch.bmp&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">#BACKUP=1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">EXTRA_SIGN=('/efi/EFI/BOOT/BOOTX64.EFI' '/efi/EFI/systemd/systemd-bootx64.efi')</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">CMDLINE_DEFAULT=&quot;cryptdevice=UUID=08be6138-f43a-4270-b5a3-f93562e7ab19:lvm:allow-discards resume=/dev/mapper/vg0-swap root=/dev/mapper/vg0-root rw quiet i915.fastboot=1&quot;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Copy all keys and certs to</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/etc/efi-keys</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cp /root/keys/*.key /etc/efi-keys</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">cp /root/keys/*.crt /etc/efi-keys</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sbupdate</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> package will create some hooks to trigger EFISTUB generation and signing after each Linux package variant (</span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">linux</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">, </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">linux-lts</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">, </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">linux-zen</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">…) update. The efi file output will always be named </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">&lt;linuxpackagename&gt;-signed.efi</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. You can test this behavior by updating/reinstalling your linux package with </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">pacman -S linux</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. There is no problem if you sign an efi file with secureboot disabled.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Or, you could manually sign your kernel with the following command:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sbsign --key /etc/efi-keys/DB.key --cert /etc/efi-keys/DB.crt --output /efi/BOOT/Arch/linux-signed.efi /efi/BOOT/Arch/linux-signed.efi</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">This will sign</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/BOOT/Arch/linux-signed.efi</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> and output to </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">/efi/BOOT/Arch/linux-signed.efi</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. Remember to sign your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> files too.</span></p>
<p style=" margin-top:9px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="deploying-your-root-of-trust"></a><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">D</span><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">eploying your Root of Trust</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">This step will be higly dependent on what hardware you are using. Some notebooks allow you to import your keys into firmware just by entering firmware setup, accessing the “Security” tab and pointing the files hosted on a</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">FAT32</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> usb drive. If your firmware does not have that option, you will have to copy your keys into a USB drive(or into your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">ESP</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> since its </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">FAT32</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">) and deploy them. To copy to your ESP partition:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">copy /root/keys/*.esl /efi/BOOT</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">copy /root/keys/*.auth /efi/BOOT</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">You will need to be sure that Secure boot is in “setup mode” not “user mode”. Some notebooks also have this option explicitly described, but others like mine will trigger setup mode as soon as you hit “remove oem keys”. After enabling setup mode, boot into</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">KeyTool.efi</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> entry. Backup the existing keys if you like, but I see no need to do it.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Now, add your keys following this order:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Select the db entry, hit “Add new key”, and point to </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">DB.esl</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Select the kek entry, hit “Add new key” and point to </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">KEK.esl</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Finally, add the Platform Key(PK), select “Replace Keys” and point to </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">PK.auth</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Exit KeyTool and reboot</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Enable Secure Boot</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Obviously </span><span style=" font-size:16px; font-weight:696;">remove all keys that are hosted on your ESP partition</span><span style=" font-size:16px;"> and KeyTool.efi(from now on, KeyTool will not work since is not signed and Secure Boot should be in user mode). Use a removal tool like </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">wipe</span><span style=" font-size:16px;"> or </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">blackarch/secure-delete</span><span style=" font-size:16px;"> to reduce the chances of recovery, or even </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">dd</span><span style=" font-size:16px;"> to create a big file with the size of the available space of your ESP partition.</span></li></ul>
<p style=" margin-top:9px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="making-linux-its-own-bootloader"></a><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">M</span><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">aking Linux it’s own bootloader</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">If your motherboard lets you create boot entries(Step 11), create an Arch Linux entry:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">efibootmgr --create /dev/sda --part 1 --label &quot;ArchLinux&quot; --loader &quot;BOOT\Arch\linux-signed.efi&quot; --verbose</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Update: ran into some issues with this word parameter syntax while trying to reproduce this environment on kvm. Solved with:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">efibootmgr -c -d /dev/sda -p 1 --label &quot;ArchLinux&quot; -l &quot;BOOT\Arch\linux-signed.efi&quot; --verbose</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">This command is pretty self-explained: ESP disk, ESP partition, label and efi location.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Now, lets check the boot order</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">[root@walhala ~]# efibootmgr</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">BootCurrent: 0000</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Timeout: 0 seconds</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">BootOrder: 0000,0002,2001,2002,2003</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot0000* Linux Boot Manager</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot0002* ArchLinux</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot2001* EFI USB Device</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot2002* EFI DVD/CDROM</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot2003* EFI Network</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Numbers could change in your setup but on my laptop</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> is </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot0000</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;">. If you delete this entry, next in order will be </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">0002</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> so, there is no need to manually order your boot entries:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">[root@walhala ~]# efibootmgr -b 0000 -B</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">BootCurrent: 0002</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Timeout: 0 seconds</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">BootOrder: 0002,2001,2002,2003</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot0002* ArchLinux</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot2001* EFI USB Device</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot2002* EFI DVD/CDROM</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">Boot2003* EFI Network</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">If</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">ArchLinux</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> isn’t your first boot option, reorder it by issuing </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">efibootmgr -o 0002,2001,2020</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> with the corresponding boot numbers of your list.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Reboot and test. Now, you should have a fully functional secureboot+efistub+luks setup :). Double-check secure boot:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">[root@walhala ~]# dmesg | grep -i secure</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">[    0.015260] Secure boot enabled</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">After that, you are free to remove any</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">systemd-boot</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> related files(line below) from your system and comment the following line on your </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">sbupdate.conf</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;"> configuration file</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c;">EXTRA_SIGN=('/efi/EFI/BOOT/BOOTX64.EFI' '/efi/EFI/systemd/systemd-bootx64.efi')</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Source Code Pro,monospace'; font-size:16px; color:#4d4d4c; background-color:#ffffff;"><br /></pre>
<p style=" margin-top:9px; margin-bottom:9px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="now-what"></a><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">N</span><span style=" font-family:'Source Serif Pro,serif'; font-size:xx-large; font-weight:696; color:#4d4d4c; background-color:#ffffff;">ow what?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Security isn’t a “one pill” medicine. There’s plenty of room for other tools to create a more secure environment:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Deploy </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">tpm2</span><span style=" font-size:16px;"> boot policies to create a Security Violation if boot options are changed</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Use </span><span style=" font-family:'Source Code Pro,monospace'; font-size:16px;">usbguard</span><span style=" font-size:16px;"> to avoid tricky devices like those usb drivers that are actually </span><a href="https://en.wikipedia.org/wiki/Human_interface_device"><span style=" font-size:16px; text-decoration: underline; color:#8959a8; background-color:transparent;">HIDs</span></a><span style=" font-size:16px;"> under-the-hood</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Setup a vpn client to use on public wifi hostpots you don’t trust much</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px;">Create a fake windows installation partition before your root luks partition</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Those are subjects to other blogposts :)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:16px; color:#4d4d4c; background-color:#ffffff;">Be safe.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p></body></html>